!!! 5
html(ng-app='uprose')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    title μProse Builder
    meta(name='description', content='')
    meta(name='viewport', content='width=device-width, initial-scale=1, user-scalable=no')
    //if lt IE 9
    script(src='//html5shiv.googlecode.com/svn/trunk/html5.js')
    link(rel='stylesheet', href='css/main.css')
  body
    .wrapper(ng-controller='EntryCtrl')
      header
        h1#buildHeader μProse Entry Builder
        div#buildBtn
          button(onClick='build()')
            | Build Entries
        br
        div#cont(ng-repeat='x in entries')
          h4 {{x.entry.title}}
            button(ng-click='showView({{x}}, {{$index}})', onclick='loadBody({{x.entry}})').
              Edit
      section
        input#title(ng-model='focusEntry.entry.title', type='text')
        div#editor
        button(ng-click='saveView(focusEntry, focusIndex)')
          |Save
      footer
        small Powered by μProse. 
    script(src='js/lib.js')
    script(src='js/u.js')
    script(src='js/src/ace.js', type='text/javascript', charset='utf-8')
    script
        var $ = document.getElementById.bind(document);
        var dom = require("ace/lib/dom");
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/twilight");
        editor.session.setMode("ace/mode/markdown");
        editor.on("change", function(e) {
          angular.element(document.getElementById('cont')).scope().focusEntry.entry.body = editor.getValue();
        });
        function loadBody(entry) {
          editor.setValue(entry.body);
        }
        function build() {
          var entrZip = JSON.stringify(angular.element(document.getElementById('cont')).scope().entries);
          var zip = new JSZip();
          zip.file("Hello.txt", "Hello World\n");
          var stor = zip.folder("stor");
          stor.file("entries.json", entrZip);
          var content = zip.generate();
          location.href = "data:application/zip;base64," + content;
        }
        

        